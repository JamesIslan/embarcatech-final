#include "constants.h"
// #include "inc/bitmaps.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "hardware/i2c.h"
#include "inc/ssd1306.h"
const uint8_t display_menu_first[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0,
  0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10,
  0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08,
  0x10, 0x99, 0x00, 0xf8, 0x00, 0x00, 0x00, 0x06, 0x01, 0x80, 0x18, 0x01, 0x80, 0x3e, 0x3e, 0x08,
  0x11, 0x18, 0x80, 0xfc, 0x00, 0x00, 0x00, 0x06, 0x01, 0x00, 0x18, 0x01, 0x80, 0x7f, 0xbf, 0x08,
  0x10, 0x18, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x18, 0x01, 0x80, 0x61, 0xb1, 0x88,
  0x10, 0x18, 0x00, 0x0c, 0x7c, 0x61, 0x8f, 0xcf, 0xf1, 0x9f, 0x18, 0x61, 0x80, 0x60, 0x30, 0xc8,
  0x11, 0xe7, 0x80, 0x0c, 0xfe, 0x61, 0xbf, 0xcf, 0xe1, 0xbf, 0x9b, 0xc1, 0x80, 0x7c, 0x30, 0xc8,
  0x11, 0xe7, 0x80, 0x0c, 0xc6, 0x61, 0xb8, 0x06, 0x01, 0xb0, 0x9b, 0x81, 0x80, 0x7c, 0x30, 0xc8,
  0x10, 0x18, 0x03, 0x0c, 0xc6, 0x61, 0x8f, 0x86, 0x01, 0xb0, 0x1c, 0x01, 0x80, 0x60, 0x30, 0xc8,
  0x10, 0x18, 0x03, 0x0c, 0xc6, 0x3f, 0x80, 0xc6, 0x19, 0xb0, 0x9b, 0x81, 0x86, 0x61, 0xb1, 0x88,
  0x11, 0x18, 0x83, 0xfc, 0xfe, 0x1f, 0x9f, 0xc7, 0xf9, 0xbf, 0x9b, 0xc0, 0xfe, 0x7f, 0xbf, 0x08,
  0x10, 0x99, 0x00, 0xf8, 0x7c, 0x01, 0xbf, 0x81, 0xf1, 0x9f, 0x18, 0x60, 0x7c, 0x3e, 0x3e, 0x08,
  0x10, 0x00, 0x00, 0x00, 0x00, 0x61, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08,
  0x10, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08,
  0x10, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08,
  0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10,
  0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x7c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x10, 0x01, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x30, 0x81, 0x86, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x51, 0x01, 0x86, 0x63, 0x3f, 0xdf, 0xe3, 0xe1, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x98, 0x01, 0xbe, 0x63, 0x3f, 0x8f, 0xef, 0xf3, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x19, 0x81, 0xbc, 0x63, 0x03, 0x01, 0x8c, 0x33, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x98, 0x01, 0x86, 0x63, 0x06, 0x03, 0x0f, 0x83, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x51, 0x01, 0x86, 0x63, 0x0c, 0x06, 0x0c, 0x33, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x30, 0x81, 0xfe, 0x7f, 0x3f, 0x8f, 0xef, 0xf3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x10, 0x00, 0x7c, 0x3e, 0x3f, 0xdf, 0xe3, 0xe3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x18, 0x01, 0x80, 0x3e, 0x3e, 0x00, 0xf8, 0x7c, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x24, 0x01, 0x80, 0x7f, 0x3f, 0x01, 0xfc, 0xff, 0x7f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x42, 0x01, 0x80, 0x63, 0x33, 0x81, 0x8c, 0xc3, 0x61, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x42, 0x01, 0x80, 0x60, 0x30, 0xc1, 0x8c, 0xc3, 0x61, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x42, 0x01, 0x80, 0x78, 0x30, 0xc1, 0x8c, 0xda, 0x6f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x5a, 0x01, 0x80, 0x78, 0x30, 0xc1, 0x8c, 0xd8, 0x6f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x5a, 0x01, 0x80, 0x60, 0x30, 0xc1, 0xf8, 0xcf, 0x61, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0xff, 0x01, 0x86, 0x61, 0x33, 0x81, 0xb0, 0xc3, 0x61, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x42, 0x01, 0xfe, 0x7f, 0x3f, 0x01, 0xb8, 0xff, 0x7f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x42, 0x00, 0x7c, 0x3e, 0x3e, 0x01, 0x8c, 0x7c, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

void run_peripherals_setup() {
  // INITIALIZE STDIO TYPES
  stdio_init_all();

  // START AND CONFIGURE LEDS
  gpio_init(LED_R_PIN);
  gpio_set_dir(LED_R_PIN, GPIO_OUT);
  gpio_init(LED_G_PIN);
  gpio_set_dir(LED_G_PIN, GPIO_OUT);
  gpio_init(LED_B_PIN);
  gpio_set_dir(LED_B_PIN, GPIO_OUT);

  // START AND CONFIGURE DISPLAY
  i2c_init(i2c1, ssd1306_i2c_clock * 100);
  gpio_set_function(I2C_SDA, GPIO_FUNC_I2C);
  gpio_set_function(I2C_SCL, GPIO_FUNC_I2C);
  gpio_pull_up(I2C_SDA);
  gpio_pull_up(I2C_SCL);
  ssd1306_init();
}

void ssd1306_draw_bitmap(ssd1306_t *ssd, const uint8_t *bitmap) {
  memset(ssd, 0, ssd1306_buffer_length); // Clear display
  // Copia o bitmap para o buffer do display
  for (int i = 0; i < ssd->bufsize - 1; i++) {
    ssd->ram_buffer[i + 1] = bitmap[i]; // O buffer começa no índice 1
  }
  // Atualiza o display com os dados do buffer
  ssd1306_send_data(ssd);
}

int main() {
  run_peripherals_setup();
  struct render_area frame_area = {
    start_column : 0,
    end_column : ssd1306_width - 1,
    start_page : 0,
    end_page : ssd1306_n_pages - 1
  };

  calculate_render_area_buffer_length(&frame_area);
  ssd1306_t ssd_bm;
  // uint8_t ssd[ssd1306_buffer_length];
  // Implement display cleasing
  while (true) {
    ssd1306_draw_bitmap(&ssd_bm, display_menu_first);
    sleep_ms(2000);
  }
}